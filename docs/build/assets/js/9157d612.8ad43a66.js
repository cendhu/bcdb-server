"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1208],{3905:function(e,n,t){t.d(n,{Zo:function(){return p},kt:function(){return A}});var a=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=a.createContext({}),d=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=d(e.components);return a.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=d(t),A=i,h=c["".concat(l,".").concat(A)]||c[A]||u[A]||r;return t?a.createElement(h,o(o({ref:n},p),{},{components:t})):a.createElement(h,o({ref:n},p))}));function A(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var r=t.length,o=new Array(r);o[0]=c;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var d=2;d<r;d++)o[d]=t[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},4695:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return d},toc:function(){return p},default:function(){return c}});var a=t(7462),i=t(3366),r=(t(7294),t(3905)),o=["components"],s={id:"usertx",title:"User Administration Transaction"},l="User Administration Transaction",d={unversionedId:"external/getting-started/transactions/curl/usertx",id:"external/getting-started/transactions/curl/usertx",isDocsHomePage:!1,title:"User Administration Transaction",description:"We can create, update and delete users of the database cluster using the user administration transaction. By issuing a POST /user/tx , we can perform the user administration.",source:"@site/docs/external/getting-started/transactions/curl/usertx.md",sourceDirName:"external/getting-started/transactions/curl",slug:"/external/getting-started/transactions/curl/usertx",permalink:"/orion-server/docs/external/getting-started/transactions/curl/usertx",tags:[],version:"current",frontMatter:{id:"usertx",title:"User Administration Transaction"},sidebar:"Documentation",previous:{title:"Database Administration Transaction",permalink:"/orion-server/docs/external/getting-started/transactions/curl/dbtx"},next:{title:"Data Transaction",permalink:"/orion-server/docs/external/getting-started/transactions/curl/datatx"}},p=[{value:"Addition of a User",id:"addition-of-a-user",children:[{value:"Check the existance of alice and bob",id:"check-the-existance-of-alice-and-bob",children:[],level:3}],level:2},{value:"Updation of a User",id:"updation-of-a-user",children:[],level:2},{value:"Deletion of a User",id:"deletion-of-a-user",children:[],level:2},{value:"Addition/Updation/Deletion of a User",id:"additionupdationdeletion-of-a-user",children:[],level:2},{value:"Invalid User Administration Transaction",id:"invalid-user-administration-transaction",children:[],level:2}],u={toc:p};function c(e){var n=e.components,t=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"user-administration-transaction"},"User Administration Transaction"),(0,r.kt)("p",null,"We can create, update and delete users of the database cluster using the user administration transaction. By issuing a ",(0,r.kt)("inlineCode",{parentName:"p"},"POST /user/tx {txPayload}"),", we can perform the user administration.\nNote that all user administration transactions must be submitted by the admin."),(0,r.kt)("p",null,"Next, we will see example for"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Addition of Users"),(0,r.kt)("li",{parentName:"ol"},"Updation of Users"),(0,r.kt)("li",{parentName:"ol"},"Deletion of Users"),(0,r.kt)("li",{parentName:"ol"},"Addition, updation, and deletion of users in a single transaction")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"As a prerequisite, examples proided here expects the node to have two user databases named ",(0,r.kt)("inlineCode",{parentName:"p"},"db1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"db2"),". Refer ",(0,r.kt)("a",{parentName:"p",href:"/orion-server/docs/external/getting-started/transactions/curl/dbtx"},"here")," for examples on creating databases.")),(0,r.kt)("h2",{id:"addition-of-a-user"},"Addition of a User"),(0,r.kt)("p",null,"When the cluster is started for the first time, it will contain only the admin user specified in the ",(0,r.kt)("inlineCode",{parentName:"p"},"config.yml"),". This admin user can add any other user to the cluster.\nIn the below example, the admin user is adding two users named ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"bob")," with certain privileges."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},' curl \\\n   -H "Content-Type: application/json" \\\n   -H "TxTimeout: 10s" \\\n   -X POST http://127.0.0.1:6001/user/tx \\\n   --data \'{\n    "payload": {\n          "user_id": "admin",\n          "tx_id": "7b6d6414-9b58-45d0-9723-1f31712add01",\n          "user_writes": [\n                {\n                      "user": {\n                            "id": "alice",\n                            "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ",\n                            "privilege": {\n                                  "db_permission": {\n                                    "db1": 0,\n                                    "db2": 1\n                                  }\n                            }\n                      }\n                },\n                {\n                      "user": {\n                            "id": "bob",\n                            "certificate": "MIIBrzCCAVWgAwIBAgIQZOQpmvY31R8yeyy3ClrJtzAKBggqhkjOPQQDAjAeMRwwGgYDVQQDExNDYXIgcmVnaXN0cnkgUm9vdENBMB4XDTIxMDYxNjExMTMyN1oXDTIyMDYxNjExMTgyN1owIjEgMB4GA1UEAxMXQ2FyIHJlZ2lzdHJ5IENsaWVudCBib2IwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASUDaIwGvRPPHHMzw4UFPTX5BTuPons8Xv3AR6k/8dDJQsn09qdtKWauLLLGxiLNDY2J8S0qPzJhJVPGF6h/l9Uo3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiAFxiyZgtiTwvMFF6jKtUE5vV0YzthpWmdRiUIbUclKzQIhALQolKPJl9xmv66wOyJTvR2q13Fb6j75M4WGcG4KfjDZ",\n                            "privilege": {\n                                  "db_permission": {\n                                        "db1": 0,\n                                        "db2": 0\n                                  }\n                            }\n                      },\n                      "acl": {\n                            "read_users": {\n                                  "admin": true\n                            }\n                      }\n                }\n\n          ]\n    },\n    "signature": "MEUCIHLCSwMzwxmnRfB6s1eON2bMfgDwFvxoSqaZ6ACXcbn0AiEA8KhjY56tSRg9Hh9UGchhGybTV2rWl1NcsAPLyW71Vu8="\n}\'\n')),(0,r.kt)("p",null,"The user ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," has read only access on the database ",(0,r.kt)("inlineCode",{parentName:"p"},"db1")," and read-write access on the database ",(0,r.kt)("inlineCode",{parentName:"p"},"db2"),". These privileges are defined under ",(0,r.kt)("inlineCode",{parentName:"p"},"db_permission"),".\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},'"db1":0')," denotes that the user has read-only privilege on database ",(0,r.kt)("inlineCode",{parentName:"p"},"db1")," while ",(0,r.kt)("inlineCode",{parentName:"p"},'"db2":1')," denotes that the user has read-write privilege on database ",(0,r.kt)("inlineCode",{parentName:"p"},"db2"),".\nIn other words, ",(0,r.kt)("inlineCode",{parentName:"p"},"0")," denotes read-only privilege and ",(0,r.kt)("inlineCode",{parentName:"p"},"1")," denotes read-write privilege. As the access control is not defined for the user,\nany user can read the credential and privilege of ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," but only ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," user can modify the properties of ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," user."),(0,r.kt)("p",null,"The user ",(0,r.kt)("inlineCode",{parentName:"p"},"bob")," has read-only privilege on the database ",(0,r.kt)("inlineCode",{parentName:"p"},"db1")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"db2"),". Further, only the ",(0,r.kt)("inlineCode",{parentName:"p"},"admin")," user can read the credential and privilege of ",(0,r.kt)("inlineCode",{parentName:"p"},"bob"),"."),(0,r.kt)("p",null,"Moreover, the user ",(0,r.kt)("inlineCode",{parentName:"p"},"bob")," cannot be modified as the ",(0,r.kt)("inlineCode",{parentName:"p"},'"read_write_users"')," section is left out empty. This means no user has permission to write to user ",(0,r.kt)("inlineCode",{parentName:"p"},"bob"),"."),(0,r.kt)("p",null,"The signature for the above transaction payload is computed by executing the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'/bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","tx_id":"7b6d6414-9b58-45d0-9723-1f31712add01","user_writes":[{"user":{"id":"alice","certificate":"MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ","privilege":{"db_permission":{"db1":0,"db2":1}}}},{"user":{"id":"bob","certificate":"MIIBrzCCAVWgAwIBAgIQZOQpmvY31R8yeyy3ClrJtzAKBggqhkjOPQQDAjAeMRwwGgYDVQQDExNDYXIgcmVnaXN0cnkgUm9vdENBMB4XDTIxMDYxNjExMTMyN1oXDTIyMDYxNjExMTgyN1owIjEgMB4GA1UEAxMXQ2FyIHJlZ2lzdHJ5IENsaWVudCBib2IwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASUDaIwGvRPPHHMzw4UFPTX5BTuPons8Xv3AR6k/8dDJQsn09qdtKWauLLLGxiLNDY2J8S0qPzJhJVPGF6h/l9Uo3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiAFxiyZgtiTwvMFF6jKtUE5vV0YzthpWmdRiUIbUclKzQIhALQolKPJl9xmv66wOyJTvR2q13Fb6j75M4WGcG4KfjDZ","privilege":{"db_permission":{"db1":0,"db2":0}}},"acl":{"read_users":{"admin":true}}}]}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MEYCIQCBA3pw0C1wgJMjOYDnhr5C0QeaSfradKdCFVCSWwXFdwIhAP80o5VZY2VBp4Lr5+4lG9hNuFL3Da53LXP9N7uAyNfn\n")),(0,r.kt)("p",null,"On a successful commit of the above transaction, the submitter of the transaction would receive the following transaction receipt:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "receipt": {\n      "header": {\n        "base_header": {\n          "number": 4,\n          "previous_base_header_hash": "gc2T0zndfbSAsw9J/67Pzjk1IAVBjE9Ih93qjwYro1k=",\n          "last_committed_block_hash": "eUxPHg5TFfTU3CRmYISAHDPI6DRHxbiQccaeytl4WBk=",\n          "last_committed_block_num": 3\n        },\n        "skipchain_hashes": [\n          "eUxPHg5TFfTU3CRmYISAHDPI6DRHxbiQccaeytl4WBk="\n        ],\n        "tx_merkel_tree_root_hash": "5nu+kdyEzZOIcy6qDDCls+GSRKK0aRdp6lbZJBUnZJQ=",\n        "state_merkel_tree_root_hash": "milzir+V4vvodu+e2BPv/j5XKlh6SfJmy3cRsBlJttw=",\n        "validation_info": [\n          {}\n        ]\n      }\n    }\n  },\n  "signature": "MEYCIQDxAuuukwThUp5ytZikobfQ0iBLMYLI6TRoK7322eNuqAIhAI5SkomPRnxH0K3iF6xqNFJUCgTHVuyelFgb9u1B4a8D"\n}\n')),(0,r.kt)("h3",{id:"check-the-existance-of-alice-and-bob"},"Check the existance of alice and bob"),(0,r.kt)("p",null,"Once the transaction get committed, we can query the user information as follows:"),(0,r.kt)("p",null,"Let's fetch the user ",(0,r.kt)("inlineCode",{parentName:"p"},"alice"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","target_user_id":"alice"}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC" \\\n     -X GET http://127.0.0.1:6001/user/alice | jq .\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "user": {\n      "id": "alice",\n      "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ",\n      "privilege": {\n        "db_permission": {\n          "db1": 0,\n          "db2": 1\n        }\n      }\n    },\n    "metadata": {\n      "version": {\n        "block_num": 4\n      }\n    }\n  },\n  "signature": "MEYCIQDY3OV2xzqe22X7PzO6UIeDY6t3Qn7DcMk5z/G8SGshvQIhAN8DnATYxIQyoj3jPufgoHuOJDTCnvpEj4kF0WtLHGRq"\n}\n')),(0,r.kt)("p",null,"Let's fetch the user ",(0,r.kt)("inlineCode",{parentName:"p"},"bob"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","target_user_id":"bob"}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MEQCICeSXCL6Atyf3hgbd0XtC4L6HT0qXTxLyvUslAv5pYMqAiAxirniW1NW1lS2pUT8G0XeWYUhUKCjjWlq6WTuGAOxEQ==\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEQCICeSXCL6Atyf3hgbd0XtC4L6HT0qXTxLyvUslAv5pYMqAiAxirniW1NW1lS2pUT8G0XeWYUhUKCjjWlq6WTuGAOxEQ==" \\\n     -X GET http://127.0.0.1:6001/user/bob | jq .\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "user": {\n      "id": "bob",\n      "certificate": "MIIBrzCCAVWgAwIBAgIQZOQpmvY31R8yeyy3ClrJtzAKBggqhkjOPQQDAjAeMRwwGgYDVQQDExNDYXIgcmVnaXN0cnkgUm9vdENBMB4XDTIxMDYxNjExMTMyN1oXDTIyMDYxNjExMTgyN1owIjEgMB4GA1UEAxMXQ2FyIHJlZ2lzdHJ5IENsaWVudCBib2IwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASUDaIwGvRPPHHMzw4UFPTX5BTuPons8Xv3AR6k/8dDJQsn09qdtKWauLLLGxiLNDY2J8S0qPzJhJVPGF6h/l9Uo3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiAFxiyZgtiTwvMFF6jKtUE5vV0YzthpWmdRiUIbUclKzQIhALQolKPJl9xmv66wOyJTvR2q13Fb6j75M4WGcG4KfjDZ",\n      "privilege": {\n        "db_permission": {\n          "db1": 0\n        }\n      }\n    },\n    "metadata": {\n      "version": {\n        "block_num": 4\n      },\n      "access_control": {\n        "read_users": {\n          "admin": true\n        }\n      }\n    }\n  },\n  "signature": "MEUCIEuGxnvi2nwzJ1AZdUBhFBkOkv26kOupKZbCgt03S85zAiEAwiyE1xJEl0F9Kx/CyylKP6dogKrcNRiVXMJcqknrOE4="\n}\n')),(0,r.kt)("h2",{id:"updation-of-a-user"},"Updation of a User"),(0,r.kt)("p",null,"Let's remove all privileges given to ",(0,r.kt)("inlineCode",{parentName:"p"},"alice"),". In order to do that, we can execute the following steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Fetch the current committed information of the ",(0,r.kt)("inlineCode",{parentName:"li"},"alice"),"."),(0,r.kt)("li",{parentName:"ol"},"Remove the privilege section and construct the transaction payload."),(0,r.kt)("li",{parentName:"ol"},"Submit the transaction payload by issuing a ",(0,r.kt)("inlineCode",{parentName:"li"},"POST /user/tx {txPayload}"))),(0,r.kt)("p",null,"Though we can update multiple users within a transaction, for simplicity, in this example, we are updating only a single user ",(0,r.kt)("inlineCode",{parentName:"p"},"alice"),"."),(0,r.kt)("p",null,"Note that the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads")," contains the version of the read information. If this does not match the committed version, the transaction would be invalidated.\nThis is useful because the ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," user can be updated by any other admin between step 1 and 2 listed above.\nTo ensure, serializability isolation, we must pass the read version. In our example, we use the version present in ",(0,r.kt)("a",{parentName:"p",href:"#check-the-existance-of-alice-and-bob"},"this"),"\nreturned result. To be specific, we can see the the version in the metadata section of the query result as shown below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'    "metadata": {\n      "version": {\n        "block_num": 4\n      }\n    }\n')),(0,r.kt)("p",null,"The version is used to perform multi-version concurrency control to ensure serializability isolation level."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads")," section says that commit this transaction only if users specified in the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads")," list are at a specified version as per the current\ncommitted state. Otherwise, invalidate the transaction and do not apply the changes requested by the transaction."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note that it is not necessary to pass the version in ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads"),". If the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads")," is left out, the write would be considered as a blind write.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Within a single transaction, we can update more than a single user. For simplicity, the example updates a single user only.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},' curl \\\n   -H "Content-Type: application/json" \\\n   -H "TxTimeout: 2s" \\\n   -X POST http://127.0.0.1:6001/user/tx \\\n   --data \'{\n    "payload": {\n        "user_id": "admin",\n        "tx_id": "1b6d6414-9b58-45d0-9723-1f31712add02",\n        "user_reads": [\n            {\n                "user_id": "alice",\n                "version": {\n                    "block_num": 4\n                }\n            }\n        ],\n        "user_writes": [\n            {\n                "user": {\n                    "id": "alice",\n                    "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ"\n                }\n            }\n        ]\n    },\n    "signature": "MEQCIGy62qM0ZGdCd5FsCvgKJ0wVQi/uL5Gy0IXhevsNxUaeAiA2pOfu5vVuQ9MJnYakFyw8HcgHR6AA3NqyxF8p3E6exw=="\n}\'\n')),(0,r.kt)("p",null,"In the above transaction, we have removed the privilege section from the user information (compare against the query result provided ",(0,r.kt)("a",{parentName:"p",href:"#check-the-existance-of-alice-and-bob"},"here"),").\nThe signature is computed using the following command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","tx_id":"1b6d6414-9b58-45d0-9723-1f31712add02","user_reads":[{"user_id":"alice","version":{"block_num":4}}],"user_writes":[{"user":{"id":"alice","certificate":"MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ"}}]}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MEQCIGy62qM0ZGdCd5FsCvgKJ0wVQi/uL5Gy0IXhevsNxUaeAiA2pOfu5vVuQ9MJnYakFyw8HcgHR6AA3NqyxF8p3E6exw==\n")),(0,r.kt)("p",null,"Once the transaction get committed, we can query the user information as follows to check whether all privileges given to the ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," have been removed:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC" \\\n     -X GET http://127.0.0.1:6001/user/alice | jq .\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "user": {\n      "id": "alice",\n      "certificate": "MIIBsjCCAVigAwIBAgIRAJp7i/UhOnaawHTSdkzxR1QwCgYIKoZIzj0EAwIwHjEcMBoGA1UEAxMTQ2FyIHJlZ2lzdHJ5IFJvb3RDQTAeFw0yMTA2MTYxMTEzMjdaFw0yMjA2MTYxMTE4MjdaMCQxIjAgBgNVBAMTGUNhciByZWdpc3RyeSBDbGllbnQgYWxpY2UwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASdCmAgHdqck7uhAK5siEF/O1EIUEIYtiR3XVEjbVhNe/6GXFShtsSThXYL9/XK6p4qF4oSy9j/PURMGnWbzSnso3EwbzAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMCMAwGA1UdEwEB/wQCMAAwHwYDVR0jBBgwFoAU7nVzp7gto++BPlj5KAF1IA62TNEwDwYDVR0RBAgwBocEfwAAATAKBggqhkjOPQQDAgNIADBFAiEAsRZlR4sDyxS//BJnYpC684EWu1hO/JU8rkNW6Nn0FFQCIH/p6m6ELkLNQpx+1QJsWWtH/LdW94WinVylhuA4jggQ",\n    },\n    "metadata": {\n      "version": {\n        "block_num": 5\n      }\n    }\n  },\n  "signature": "MEYCIQDY3OV2xzqe22X7PzO6UIeDY6t3Qn7DcMk5z/G8SGshvQIhAN8DnATYxIQyoj3jPufgoHuOJDTCnvpEj4kF0WtLHGRq"\n}\n')),(0,r.kt)("p",null,"As we can see, the privilege section is no longer present and the version has been increased too."),(0,r.kt)("h2",{id:"deletion-of-a-user"},"Deletion of a User"),(0,r.kt)("p",null,"Let's delete ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," from the cluster. In order to do that, we can execute the following steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Fetch the current committed information of the ",(0,r.kt)("inlineCode",{parentName:"li"},"alice")," to get the committed version."),(0,r.kt)("li",{parentName:"ol"},"Add the committed version to the ",(0,r.kt)("inlineCode",{parentName:"li"},"user_reads"),"."),(0,r.kt)("li",{parentName:"ol"},"Add the ",(0,r.kt)("inlineCode",{parentName:"li"},"alice")," to the ",(0,r.kt)("inlineCode",{parentName:"li"},"user_deletes")),(0,r.kt)("li",{parentName:"ol"},"Submit the transaction payload by issuing a ",(0,r.kt)("inlineCode",{parentName:"li"},"POST /user/tx {txPayload}"))),(0,r.kt)("p",null,"The example uses ",(0,r.kt)("inlineCode",{parentName:"p"},'"block_num": 5')," as the version. While executing this example, query the user ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," and use the version provided in the output of the query.\nRefer ",(0,r.kt)("a",{parentName:"p",href:"#updation-of-a-user"},"here")," for the query result of ",(0,r.kt)("inlineCode",{parentName:"p"},"alice")," after being updated. In the query result, we have"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'    "metadata": {\n      "version": {\n        "block_num": 5\n      }\n    }\n')),(0,r.kt)("p",null,"Hence, this example uses ",(0,r.kt)("inlineCode",{parentName:"p"},'"block_num": 5')," as the version."),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Note that it is not necessary to pass the version in ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads"),". If the ",(0,r.kt)("inlineCode",{parentName:"p"},"user_reads")," is left out, the delete would be considered as a blind delete. For blind delete, steps 1 and 2 are not needed.")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Within a single transaction, we can delete more than a single user. For simplicity, the example delete a single user only.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},' curl \\\n   -H "Content-Type: application/json" \\\n   -H "TxTimeout: 2s" \\\n   -X POST http://127.0.0.1:6001/user/tx \\\n   --data \'{\n    "payload": {\n        "user_id": "admin",\n        "tx_id": "1b6d6414-9b58-45d0-9723-1f31712add04",\n        "user_reads": [\n            {\n                "user_id": "alice",\n                "version": {\n                    "block_num": 5\n                }\n            }\n        ],\n        "user_deletes": [\n            {\n                "user_id": "alice"\n            }\n        ]\n    },\n    "signature": "MEUCIFDGfF7deiAexylyN/C1DINgz5TA5CbIB/w+AnjhZYYTAiEAvGtgFWWtWWQaGr4EWo4whcs/+pHhgYMyYeFPha8YRhg="\n}\'\n')),(0,r.kt)("p",null,"The section ",(0,r.kt)("inlineCode",{parentName:"p"},"user_deletes")," is an array and we can pass as many number of users in it and all will be deleted if they exist.\nThe signature on the payload is computed using the following command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'./bin/signer -privatekey=deployment/sample/crypto/admin/admin.key -data=\'{"user_id":"admin","tx_id":"1b6d6414-9b58-45d0-9723-1f31712add04","user_reads":[{"user_id":"alice","version":{"block_num":5}}],"user_deletes":[{"user_id":"alice"}]}\'\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"MEUCIFDGfF7deiAexylyN/C1DINgz5TA5CbIB/w+AnjhZYYTAiEAvGtgFWWtWWQaGr4EWo4whcs/+pHhgYMyYeFPha8YRhg=\n")),(0,r.kt)("p",null,"Once the transaction is validated and committed, the submitter of the transaction recevies the following transaction receipt"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    },\n    "receipt": {\n      "header": {\n        "base_header": {\n          "number": 7,\n          "previous_base_header_hash": "+KCuJm2x9LzsIBFmAVkW6w/Hmw7IRjl52aZjNI7juR8=",\n          "last_committed_block_hash": "7nEaUCRBiGvmrhbhl7tzupb0K/KjGdS/SSJtCLjvsjA=",\n          "last_committed_block_num": 6\n        },\n        "skipchain_hashes": [\n          "7nEaUCRBiGvmrhbhl7tzupb0K/KjGdS/SSJtCLjvsjA=",\n          "IHP38VOoGoVHAHROXPZJ8ZWG3pZ6rmqQYovVzm5i7rw="\n        ],\n        "tx_merkel_tree_root_hash": "iz84iY89BolcBkVD8okAAqg5duGT/+eivcTO4OcpnNM=",\n        "state_merkel_tree_root_hash": "tAb0KTsd9JgCQ1YZMwYLs2O3wpo0ynA7h22B8pKzBC0=",\n        "validation_info": [\n          {}\n        ]\n     }\n    }\n  },\n  "signature": "MEUCIGWLKxgnxwlznZyBbKbpiFcnbUv32CbkBaFitOxEWnSMAiEAqcNh9pswgvF7f1leWrteozij2zSlG78gcfP5+eAfHhA="\n}\n')),(0,r.kt)("p",null,"If we query the user, the response would not contain any details associated with the user."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},'curl \\\n     -H "Content-Type: application/json" \\\n     -H "UserID: admin" \\\n     -H "Signature: MEYCIQDioRVRhtdaLEjFSeCPqrVCCtdwq+hvy7Y+i3cXaqhZ3wIhAK/gmdftR4x0KF3w8V86hSYXPehf/rlO8QcSnU9sFnvC" \\\n     -X GET http://127.0.0.1:6001/user/alice | jq .\n')),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Output")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "response": {\n    "header": {\n      "node_id": "bdb-node-1"\n    }\n  },\n  "signature": "MEUCIDV6UgjPLtM5c+WqQ+Ue5xcKe/w85nAdwwRl7qPqJByVAiEA4RTqXa8Xf8S+O8YPRpFgIHzOCH5jOHkL2jMmLG7Zdpw="\n}\n')),(0,r.kt)("h2",{id:"additionupdationdeletion-of-a-user"},"Addition/Updation/Deletion of a User"),(0,r.kt)("p",null,"Within a single transaction, we can do multiple operations such as adding multiple new users, updating and deleting multiple\nexisting users."),(0,r.kt)("h2",{id:"invalid-user-administration-transaction"},"Invalid User Administration Transaction"),(0,r.kt)("p",null,"TODO (subsequent PR)"))}c.isMDXComponent=!0}}]);